name: Submit sitemap to IndexNow

on:
  workflow_run:
    workflows: [MkDocs]
    branches: master
    types: completed

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.13"
      - name: Install dependencies
        run: pip install index-now-for-python
      - name: Submit sitemap to IndexNow
        uses: jannekem/run-python-script-action@v1
        with:
          script: |
            from index_now import submit_sitemap_to_index_now, IndexNowAuthentication, SearchEngineEndpoint

            authentication = IndexNowAuthentication(
              host="jakob-bagterp.github.io",
              api_key="6d71a14ac15c4c41a0c19e641f659208",
              api_key_location="https://jakob-bagterp.github.io/index-now-api-key.txt",
            )

            submit_sitemap_to_index_now(authentication, https://jakob-bagterp.github.io/index-now-for-python/sitemap.xml, endpoint=SearchEngineEndpoint.YANDEX)
